<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Little Library Scout</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        // Lucide React icons as inline SVG components
        const Camera = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
        );

        const Upload = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
            </svg>
        );

        const BookOpen = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
            </svg>
        );

        const Star = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
            </svg>
        );

        const ThumbsUp = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5" />
            </svg>
        );

        const ThumbsDown = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 14H5.236a2 2 0 01-1.789-2.894l3.5-7A2 2 0 018.736 3h4.018a2 2 0 01.485.06l3.76.94m-7 10v5a2 2 0 002 2h.096c.5 0 .905-.405.905-.904 0-.715.211-1.413.608-2.008L17 13V4m-7 10h2m5-10h2a2 2 0 012 2v6a2 2 0 01-2 2h-2.5" />
            </svg>
        );

        const Loader2 = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" />
            </svg>
        );

        function LittleLibraryRecommender() {
            const [image, setImage] = useState(null);
            const [imagePreview, setImagePreview] = useState(null);
            const [goodreadsData, setGoodreadsData] = useState('');
            const [goodreadsConnected, setGoodreadsConnected] = useState(false);
            const [goodreadsScreenshot, setGoodreadsScreenshot] = useState(null);
            const [goodreadsScreenshotPreview, setGoodreadsScreenshotPreview] = useState(null);
            const [analyzingScreenshot, setAnalyzingScreenshot] = useState(false);
            const [analyzing, setAnalyzing] = useState(false);
            const [results, setResults] = useState(null);
            const [error, setError] = useState('');
            const fileInputRef = useRef(null);
            const goodreadsInputRef = useRef(null);

            // Load saved preferences on component mount
            useEffect(() => {
                const savedPreferences = localStorage.getItem('littleLibraryPreferences');
                if (savedPreferences) {
                    try {
                        const parsed = JSON.parse(savedPreferences);
                        if (parsed.goodreadsData) {
                            setGoodreadsData(parsed.goodreadsData);
                            setGoodreadsConnected(true);
                        }
                    } catch (e) {
                        console.error('Error loading saved preferences:', e);
                    }
                }
            }, []);

            // Save preferences whenever they change
            useEffect(() => {
                if (goodreadsData && goodreadsConnected) {
                    localStorage.setItem('littleLibraryPreferences', JSON.stringify({
                        goodreadsData,
                        savedAt: new Date().toISOString()
                    }));
                }
            }, [goodreadsData, goodreadsConnected]);

            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    setImage(file);
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        setImagePreview(reader.result);
                    };
                    reader.readAsDataURL(file);
                    setResults(null);
                    setError('');
                }
            };

            const handleGoodreadsScreenshot = (e) => {
                const file = e.target.files[0];
                if (file) {
                    setGoodreadsScreenshot(file);
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        setGoodreadsScreenshotPreview(reader.result);
                    };
                    reader.readAsDataURL(file);
                }
            };

            const analyzeGoodreadsScreenshot = async () => {
                if (!goodreadsScreenshot) {
                    setError('Please upload a screenshot first');
                    return;
                }

                setAnalyzingScreenshot(true);
                setError('');

                try {
                    const reader = new FileReader();
                    reader.onloadend = async () => {
                        const base64Data = reader.result;
                        const base64Image = base64Data.split(',')[1];
                        
                        let media_type = 'image/jpeg';
                        if (base64Data.startsWith('data:image/png')) {
                            media_type = 'image/png';
                        } else if (base64Data.startsWith('data:image/webp')) {
                            media_type = 'image/webp';
                        } else if (base64Data.startsWith('data:image/gif')) {
                            media_type = 'image/gif';
                        }

                        const response = await fetch('https://api.anthropic.com/v1/messages', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                model: 'claude-sonnet-4-20250514',
                                max_tokens: 2000,
                                messages: [
                                    {
                                        role: 'user',
                                        content: [
                                            {
                                                type: 'image',
                                                source: {
                                                    type: 'base64',
                                                    media_type: media_type,
                                                    data: base64Image
                                                }
                                            },
                                            {
                                                type: 'text',
                                                text: `This is a screenshot from someone's Goodreads account showing their book ratings, shelves, or recommendations.

Please extract their reading preferences by analyzing:
- Book titles and authors visible in the screenshot
- Star ratings (if visible)
- Genres or categories shown
- Any patterns in their reading taste

Create a comprehensive summary of their reading preferences that will help match them with books from little libraries.

Write a natural, detailed summary that includes:
1. Specific book titles and authors you can see
2. The genres or categories shown
3. Any rating patterns (if visible)
4. The types of books they seem to enjoy

Be as detailed and specific as possible. Include every book title and author you can read clearly.`
                                            }
                                        ]
                                    }
                                ]
                            })
                        });

                        const data = await response.json();
                        
                        console.log('Screenshot analysis response:', data);
                        
                        if (data.content && data.content.length > 0) {
                            const fullResponse = data.content
                                .map(item => (item.type === "text" ? item.text : ""))
                                .filter(Boolean)
                                .join("\n")
                                .trim();
                            
                            if (fullResponse && fullResponse.length > 20) {
                                setGoodreadsData(fullResponse);
                                setGoodreadsConnected(true);
                                setError('');
                            } else {
                                setError('Could not extract enough information from the screenshot. Please try a clearer image with visible book titles, or enter preferences manually.');
                            }
                        } else if (data.error) {
                            setError('API Error: ' + (data.error.message || 'Unknown error'));
                        } else {
                            setError('Could not analyze the screenshot. Please try a clearer image with visible book titles and ratings, or enter preferences manually.');
                        }
                    };

                    reader.onerror = () => {
                        setError('Error reading screenshot file. Please try again.');
                    };

                    reader.readAsDataURL(goodreadsScreenshot);
                } catch (err) {
                    console.error('Screenshot analysis error:', err);
                    setError('Error analyzing screenshot: ' + err.message + '. Please try entering preferences manually.');
                } finally {
                    setAnalyzingScreenshot(false);
                }
            };

            const analyzeLibrary = async () => {
                if (!image) {
                    setError('Please upload a photo of a little library');
                    return;
                }

                if (!goodreadsData.trim()) {
                    setError('Please provide information about books you\'ve enjoyed');
                    return;
                }

                setAnalyzing(true);
                setError('');
                setResults(null);

                try {
                    const reader = new FileReader();
                    reader.onloadend = async () => {
                        const base64Image = reader.result.split(',')[1];

                        const response = await fetch('https://api.anthropic.com/v1/messages', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                model: 'claude-sonnet-4-20250514',
                                max_tokens: 1000,
                                messages: [
                                    {
                                        role: 'user',
                                        content: [
                                            {
                                                type: 'image',
                                                source: {
                                                    type: 'base64',
                                                    media_type: 'image/jpeg',
                                                    data: base64Image
                                                }
                                            },
                                            {
                                                type: 'text',
                                                text: `Analyze this photo of a "little library" (neighborhood book sharing box) and identify any visible book titles and authors you can read from the spines or covers.

Then, based on this person's reading preferences and history, honestly assess whether ANY of these books would genuinely interest them:

${goodreadsData}

IMPORTANT: Be honest and selective. It's perfectly fine (and often better) to recommend ZERO books if nothing truly matches their taste. Don't recommend books just to be nice - only recommend books you genuinely think they'll enjoy based on their preferences. Most little libraries won't have great matches, and that's okay.

Guidelines:
- Only recommend books that are a STRONG match (3+ stars potential)
- If nothing matches well, leave "recommendations" as an empty array
- Be honest about mismatches - it's helpful for them to know what to skip
- If the user loves literary fiction and you see romance novels, say there's nothing for them
- Quality over quantity - recommending nothing is better than recommending mediocre matches

CRITICAL - GENRE INTERPRETATION:
- A low rating (1-3 stars) for ONE book in a genre does NOT mean they dislike the entire genre
- Look for PATTERNS across multiple books, not single data points
- If they rated 1 sci-fi book poorly but 5 sci-fi books highly, they LOVE sci-fi
- Focus on what they consistently enjoy (high ratings, favorite authors, stated preferences)
- A bad review means "I didn't like THIS book" not "I hate THIS genre"
- Example: "Didn't like 'Twilight' (2 stars)" doesn't mean they hate all fantasy/romance - look at their other ratings in those genres
- Only exclude a genre if they explicitly say they don't like it OR have consistently low ratings (3+ books) in that genre

PHOTO QUALITY ASSESSMENT:
- Evaluate how well you can read the book titles and authors in this photo
- Consider: lighting, angle, focus, distance, text visibility
- Rate from 1-10 where:
  * 1-3 = Poor (very few titles readable, suggest retaking)
  * 4-6 = Fair (some titles readable, could be better)
  * 7-8 = Good (most titles readable)
  * 9-10 = Excellent (all or nearly all titles clearly readable)

Please respond ONLY with valid JSON (no markdown, no preamble) in this exact format:
{
  "photoQuality": {
    "score": 7,
    "readableCount": 12,
    "totalVisible": 15,
    "feedback": "Brief feedback on photo quality and suggestions if needed"
  },
  "booksIdentified": [
    {
      "title": "Book Title",
      "author": "Author Name",
      "confidence": "high/medium/low"
    }
  ],
  "overallAssessment": "A brief honest take on whether this little library has anything for this reader",
  "recommendations": [
    {
      "title": "Book Title",
      "author": "Author Name",
      "reason": "Brief explanation of why this matches their preferences",
      "rating": 4
    }
  ],
  "notRecommended": [
    {
      "title": "Book Title",
      "author": "Author Name",
      "reason": "Brief explanation of why this doesn't match"
    }
  ]
}`
                                            }
                                        ]
                                    }
                                ]
                            })
                        });

                        const data = await response.json();
                        
                        if (data.content && data.content[0] && data.content[0].text) {
                            let jsonText = data.content[0].text.trim();
                            jsonText = jsonText.replace(/```json\n?/g, '').replace(/```\n?/g, '');
                            
                            try {
                                const parsedResults = JSON.parse(jsonText);
                                setResults(parsedResults);
                            } catch (parseError) {
                                console.error('Parse error:', parseError);
                                setError('Could not parse the analysis results. Please try again.');
                            }
                        } else {
                            setError('No response from analysis service');
                        }
                    };

                    reader.onerror = () => {
                        setError('Error reading image file');
                    };

                    reader.readAsDataURL(image);
                } catch (err) {
                    console.error('Analysis error:', err);
                    setError('Error analyzing image: ' + err.message);
                } finally {
                    setAnalyzing(false);
                }
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-amber-50 via-orange-50 to-rose-50 p-6">
                    <div className="max-w-4xl mx-auto">
                        {/* Header */}
                        <div className="text-center mb-8">
                            <div className="flex items-center justify-center gap-3 mb-3">
                                <BookOpen className="w-10 h-10 text-amber-700" />
                                <h1 className="text-4xl font-bold text-amber-900">Little Library Scout</h1>
                            </div>
                            <p className="text-amber-700 text-lg">
                                Discover your next great read from neighborhood book boxes
                            </p>
                        </div>

                        {/* Main Content */}
                        <div className="bg-white rounded-2xl shadow-xl p-8 mb-6">
                            {/* Step 1: Upload Image */}
                            <div className="mb-8">
                                <h2 className="text-2xl font-semibold text-gray-800 mb-4 flex items-center gap-2">
                                    <Camera className="w-6 h-6 text-amber-600" />
                                    Step 1: Upload Little Library Photo
                                </h2>
                                
                                <div className="border-3 border-dashed border-amber-300 rounded-xl p-8 text-center bg-amber-50/50">
                                    <input
                                        ref={fileInputRef}
                                        type="file"
                                        accept="image/*"
                                        onChange={handleImageUpload}
                                        className="hidden"
                                    />
                                    
                                    {imagePreview ? (
                                        <div className="space-y-4">
                                            <img 
                                                src={imagePreview} 
                                                alt="Little library" 
                                                className="max-h-64 mx-auto rounded-lg shadow-md"
                                            />
                                            <button
                                                onClick={() => fileInputRef.current?.click()}
                                                className="px-6 py-2 bg-amber-100 text-amber-800 rounded-lg hover:bg-amber-200 transition-colors"
                                            >
                                                Change Photo
                                            </button>
                                        </div>
                                    ) : (
                                        <button
                                            onClick={() => fileInputRef.current?.click()}
                                            className="flex flex-col items-center gap-3 mx-auto"
                                        >
                                            <Upload className="w-16 h-16 text-amber-400" />
                                            <span className="text-lg text-gray-700">Click to upload a photo</span>
                                            <span className="text-sm text-gray-500">JPG, PNG, or HEIC</span>
                                        </button>
                                    )}
                                </div>
                            </div>

                            {/* Step 2: Goodreads Info */}
                            <div className="mb-8">
                                <h2 className="text-2xl font-semibold text-gray-800 mb-4 flex items-center gap-2">
                                    <Star className="w-6 h-6 text-amber-600" />
                                    Step 2: Share Your Reading Preferences
                                </h2>
                                
                                {goodreadsConnected ? (
                                    <div className="space-y-4">
                                        <div className="p-6 bg-green-50 rounded-xl border-2 border-green-300">
                                            <div className="flex items-center justify-between mb-3">
                                                <div className="flex items-center gap-3">
                                                    <div className="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center">
                                                        <BookOpen className="w-6 h-6 text-white" />
                                                    </div>
                                                    <div>
                                                        <h3 className="font-semibold text-gray-800">Reading Preferences Set</h3>
                                                        <p className="text-sm text-gray-600">‚úì Saved - will load automatically next time</p>
                                                    </div>
                                                </div>
                                                <button
                                                    onClick={() => {
                                                        setGoodreadsConnected(false);
                                                        setGoodreadsData('');
                                                        setGoodreadsScreenshot(null);
                                                        setGoodreadsScreenshotPreview(null);
                                                        localStorage.removeItem('littleLibraryPreferences');
                                                    }}
                                                    className="text-sm text-gray-500 hover:text-gray-700 underline"
                                                >
                                                    Clear & Edit
                                                </button>
                                            </div>
                                            <div className="bg-white p-4 rounded-lg text-sm text-gray-700 max-h-48 overflow-y-auto">
                                                {goodreadsData}
                                            </div>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="space-y-6">
                                        {/* Screenshot Upload Option */}
                                        <div className="p-6 bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl border-2 border-amber-200">
                                            <div className="flex items-start gap-3 mb-4">
                                                <Camera className="w-6 h-6 text-amber-600 flex-shrink-0 mt-1" />
                                                <div>
                                                    <h3 className="font-semibold text-lg text-gray-800 mb-2">üì∏ Upload Goodreads Screenshot (Quick!)</h3>
                                                    <p className="text-sm text-gray-600 mb-3">
                                                        Take a screenshot of your Goodreads shelves, ratings, or "My Books" page and we'll extract your preferences automatically.
                                                    </p>
                                                    <p className="text-xs text-gray-500 mb-4">
                                                        üí° Best results: screenshot showing book titles, authors, and star ratings
                                                    </p>
                                                </div>
                                            </div>

                                            <input
                                                ref={goodreadsInputRef}
                                                type="file"
                                                accept="image/*"
                                                onChange={handleGoodreadsScreenshot}
                                                className="hidden"
                                            />

                                            {goodreadsScreenshotPreview ? (
                                                <div className="space-y-4 relative">
                                                    <div className="relative">
                                                        <img 
                                                            src={goodreadsScreenshotPreview} 
                                                            alt="Goodreads screenshot" 
                                                            className="max-h-64 mx-auto rounded-lg shadow-md border-2 border-amber-300"
                                                            style={{ opacity: analyzingScreenshot ? 0.5 : 1 }}
                                                        />
                                                        {analyzingScreenshot && (
                                                            <div className="absolute inset-0 flex items-center justify-center bg-black bg-opacity-30 rounded-lg">
                                                                <div className="bg-white px-6 py-4 rounded-lg shadow-xl flex items-center gap-3">
                                                                    <Loader2 className="w-6 h-6 animate-spin text-amber-600" />
                                                                    <span className="font-semibold text-gray-800">Analyzing...</span>
                                                                </div>
                                                            </div>
                                                        )}
                                                    </div>
                                                    <div className="flex gap-3">
                                                        <button
                                                            onClick={analyzeGoodreadsScreenshot}
                                                            disabled={analyzingScreenshot}
                                                            className="flex-1 py-3 bg-amber-500 text-white rounded-lg font-semibold hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                                                        >
                                                            {analyzingScreenshot ? (
                                                                <>
                                                                    <Loader2 className="w-5 h-5 animate-spin" />
                                                                    Analyzing... (this may take 10-15 seconds)
                                                                </>
                                                            ) : (
                                                                <>
                                                                    <Star className="w-5 h-5" />
                                                                    Extract Preferences
                                                                </>
                                                            )}
                                                        </button>
                                                        <button
                                                            onClick={() => {
                                                                setGoodreadsScreenshot(null);
                                                                setGoodreadsScreenshotPreview(null);
                                                            }}
                                                            className="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"
                                                        >
                                                            Remove
                                                        </button>
                                                    </div>
                                                </div>
                                            ) : (
                                                <button
                                                    onClick={() => goodreadsInputRef.current?.click()}
                                                    className="w-full py-4 border-3 border-dashed border-amber-300 rounded-lg bg-white hover:bg-amber-50 transition-colors flex items-center justify-center gap-3"
                                                >
                                                    <Upload className="w-6 h-6 text-amber-500" />
                                                    <span className="text-gray-700 font-medium">Click to Upload Screenshot</span>
                                                </button>
                                            )}
                                        </div>

                                        {/* Divider */}
                                        <div className="flex items-center gap-4">
                                            <div className="flex-1 h-px bg-gray-300"></div>
                                            <span className="text-sm text-gray-500 font-medium">OR</span>
                                            <div className="flex-1 h-px bg-gray-300"></div>
                                        </div>

                                        {/* Manual Input Option */}
                                        <div className="space-y-4">
                                            <div className="p-4 bg-amber-50 rounded-xl border-2 border-amber-200">
                                                <div className="flex gap-3 mb-3">
                                                    <BookOpen className="w-5 h-5 text-amber-600 flex-shrink-0 mt-1" />
                                                    <div className="text-sm text-gray-700">
                                                        <p className="font-semibold mb-2">‚úçÔ∏è Type Your Preferences</p>
                                                        <p className="text-gray-600">Manually enter books you've loved and genres you enjoy</p>
                                                    </div>
                                                </div>
                                            </div>

                                            <textarea
                                                value={goodreadsData}
                                                onChange={(e) => setGoodreadsData(e.target.value)}
                                                placeholder={`Paste your favorite books and reading preferences here. For example:

üìö Books I loved (5 stars):
‚Ä¢ The Night Circus by Erin Morgenstern
‚Ä¢ Project Hail Mary by Andy Weir
‚Ä¢ Circe by Madeline Miller

üìö Books I enjoyed (4 stars):
‚Ä¢ The Martian by Andy Weir
‚Ä¢ The Invisible Life of Addie LaRue by V.E. Schwab

üé≠ Genres I love:
‚Ä¢ Literary fiction, Science fiction, Magical realism, Historical fiction

üëé Not a fan of:
‚Ä¢ Romance novels, Mystery/thrillers, Self-help

‚úçÔ∏è Favorite authors:
‚Ä¢ Neil Gaiman, Ursula K. Le Guin, Ted Chiang, N.K. Jemisin

The more specific you are, the better the recommendations!`}
                                                className="w-full h-64 p-4 border-2 border-amber-200 rounded-xl focus:border-amber-400 focus:outline-none resize-none text-gray-700 text-sm font-mono"
                                            />
                                            
                                            <button
                                                onClick={() => {
                                                    if (goodreadsData.trim()) {
                                                        setGoodreadsConnected(true);
                                                        setError('');
                                                    } else {
                                                        setError('Please enter your reading preferences first');
                                                    }
                                                }}
                                                disabled={!goodreadsData.trim()}
                                                className="px-6 py-3 bg-amber-500 text-white rounded-lg font-semibold hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                                            >
                                                Save Preferences
                                            </button>
                                        </div>
                                    </div>
                                )}
                            </div>

                            {/* Analyze Button */}
                            <button
                                onClick={analyzeLibrary}
                                disabled={analyzing || !image || !goodreadsData.trim()}
                                className="w-full py-4 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-xl font-semibold text-lg hover:from-amber-600 hover:to-orange-600 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-3 shadow-lg"
                            >
                                {analyzing ? (
                                    <>
                                        <Loader2 className="w-6 h-6 animate-spin" />
                                        Analyzing... (this may take 10-15 seconds)
                                    </>
                                ) : (
                                    <>
                                        <BookOpen className="w-6 h-6" />
                                        Find My Next Read
                                    </>
                                )}
                            </button>

                            {/* Error Message */}
                            {error && (
                                <div className="mt-4 p-4 bg-red-50 border-2 border-red-200 rounded-xl text-red-700">
                                    {error}
                                </div>
                            )}
                        </div>

                        {/* Results */}
                        {results && (
                            <div className="space-y-6">
                                {/* Photo Quality Score */}
                                {results.photoQuality && (
                                    <div className={`rounded-2xl shadow-xl p-6 border-2 ${
                                        results.photoQuality.score >= 7 
                                          ? 'bg-green-50 border-green-300' 
                                          : results.photoQuality.score >= 4 
                                          ? 'bg-yellow-50 border-yellow-300' 
                                          : 'bg-red-50 border-red-300'
                                    }`}>
                                        <div className="flex items-start gap-4">
                                            <div className="flex-shrink-0">
                                                <div className={`w-16 h-16 rounded-full flex items-center justify-center text-2xl font-bold ${
                                                    results.photoQuality.score >= 7 
                                                      ? 'bg-green-500 text-white' 
                                                      : results.photoQuality.score >= 4 
                                                      ? 'bg-yellow-500 text-white' 
                                                      : 'bg-red-500 text-white'
                                                }`}>
                                                    {results.photoQuality.score}
                                                </div>
                                            </div>
                                            <div className="flex-1">
                                                <h3 className="text-lg font-semibold text-gray-800 mb-1">
                                                    Photo Quality Score
                                                </h3>
                                                <p className="text-sm text-gray-600 mb-2">
                                                    Could read {results.photoQuality.readableCount} of {results.photoQuality.totalVisible} visible books
                                                </p>
                                                <p className="text-gray-700">
                                                    {results.photoQuality.feedback}
                                                </p>
                                                {results.photoQuality.score < 7 && (
                                                    <div className="mt-3 p-3 bg-white rounded-lg border-2 border-current">
                                                        <p className="text-sm font-semibold text-gray-800 mb-1">üí° Tips for better photos:</p>
                                                        <ul className="text-sm text-gray-600 space-y-1">
                                                            <li>‚Ä¢ Get closer to the books</li>
                                                            <li>‚Ä¢ Make sure lighting is good (avoid shadows)</li>
                                                            <li>‚Ä¢ Hold camera steady and focus on the spines</li>
                                                            <li>‚Ä¢ Take photo straight-on rather than at an angle</li>
                                                        </ul>
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* Overall Assessment */}
                                {results.overallAssessment && (
                                    <div className="bg-white rounded-2xl shadow-xl p-8 border-2 border-amber-200">
                                        <h2 className="text-2xl font-semibold text-gray-800 mb-3">
                                            üìñ Overall Assessment
                                        </h2>
                                        <p className="text-lg text-gray-700 leading-relaxed">
                                            {results.overallAssessment}
                                        </p>
                                    </div>
                                )}

                                {/* Books Identified */}
                                <div className="bg-white rounded-2xl shadow-xl p-8">
                                    <h2 className="text-2xl font-semibold text-gray-800 mb-4">
                                        üìö Books I Found ({results.booksIdentified?.length || 0})
                                    </h2>
                                    {results.booksIdentified && results.booksIdentified.length > 0 ? (
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            {results.booksIdentified.map((book, idx) => (
                                                <div key={idx} className="p-4 bg-gray-50 rounded-lg border-2 border-gray-200">
                                                    <div className="font-semibold text-gray-800">{book.title}</div>
                                                    <div className="text-sm text-gray-600">{book.author}</div>
                                                    <div className="text-xs text-gray-500 mt-1">
                                                        Confidence: {book.confidence}
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    ) : (
                                        <p className="text-gray-600">No books could be clearly identified in this photo.</p>
                                    )}
                                </div>

                                {/* Recommendations */}
                                {results.recommendations && results.recommendations.length > 0 ? (
                                    <div className="bg-gradient-to-br from-green-50 to-emerald-50 rounded-2xl shadow-xl p-8 border-2 border-green-200">
                                        <h2 className="text-2xl font-semibold text-green-800 mb-4 flex items-center gap-2">
                                            <ThumbsUp className="w-7 h-7" />
                                            Worth Picking Up! ({results.recommendations.length})
                                        </h2>
                                        <div className="space-y-4">
                                            {results.recommendations.map((book, idx) => (
                                                <div key={idx} className="p-6 bg-white rounded-xl shadow-md border-2 border-green-300">
                                                    <div className="flex items-start justify-between mb-2">
                                                        <div>
                                                            <div className="font-bold text-lg text-gray-800">{book.title}</div>
                                                            <div className="text-gray-600">{book.author}</div>
                                                        </div>
                                                        <div className="flex gap-1">
                                                            {[...Array(book.rating || 0)].map((_, i) => (
                                                                <Star key={i} className="w-5 h-5 fill-yellow-400 text-yellow-400" />
                                                            ))}
                                                        </div>
                                                    </div>
                                                    <p className="text-gray-700 mt-3 leading-relaxed">{book.reason}</p>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                ) : (
                                    <div className="bg-gradient-to-br from-gray-50 to-slate-50 rounded-2xl shadow-xl p-8 border-2 border-gray-300">
                                        <h2 className="text-2xl font-semibold text-gray-700 mb-4 flex items-center gap-2">
                                            ü§∑ Nothing Jumps Out
                                        </h2>
                                        <p className="text-lg text-gray-600 leading-relaxed">
                                            Based on your reading taste, there's nothing in this little library that seems like a strong match. Better to save your reading time for books you'll really enjoy!
                                        </p>
                                        <p className="text-sm text-gray-500 mt-4">
                                            üí° Keep checking other little libraries in your neighborhood - you never know what treasures you'll find next.
                                        </p>
                                    </div>
                                )}

                                {/* Not Recommended */}
                                {results.notRecommended && results.notRecommended.length > 0 && (
                                    <div className="bg-gray-50 rounded-2xl shadow-xl p-8 border-2 border-gray-200">
                                        <h2 className="text-2xl font-semibold text-gray-700 mb-4 flex items-center gap-2">
                                            <ThumbsDown className="w-7 h-7" />
                                            Probably Skip These
                                        </h2>
                                        <div className="space-y-3">
                                            {results.notRecommended.map((book, idx) => (
                                                <div key={idx} className="p-4 bg-white rounded-lg">
                                                    <div className="font-semibold text-gray-800">{book.title}</div>
                                                    <div className="text-sm text-gray-600 mb-2">{book.author}</div>
                                                    <p className="text-sm text-gray-600">{book.reason}</p>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}

                        {/* Footer */}
                        <div className="text-center mt-8 text-sm text-gray-600">
                            <p>üí° Tip: Take clear photos with good lighting for best results</p>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<LittleLibraryRecommender />, document.getElementById('root'));
    </script>
</body>
</html>
